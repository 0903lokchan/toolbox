{% extends 'base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block scripts %}
    <script>

        function cal_sim() {
            var dice = document.getElementById("dice");
            var side = document.getElementById("side");
            var result = document.getElementById("result");

            var entry = {
                        dice: dice.value,
                        side: side.value
                        };

            fetch(`${window.origin}/dice_cal/cal_sim`, {
            method: "POST",
            credentials: "include",
            body: JSON.stringify(entry),
            cache: "no-cache",
            headers: new Headers({
                "content-type": "application/json"
            })
        })
            .then(function (response) {
                if (response.status !== 200) {
                    console.log(`Looks like there was a problem. Status code: ${response.status}`);
                    return;
                }
                response.json().then(function (data) {
                    console.log(data);
                    result.innerHTML = data['text'];
                });
            })
            .catch(function (error) {
                console.log("Fetch error: " + error);
            });
        }

    </script>
{% endblock scripts %}

{% block app_content %}
    <div class="container-fluid">
        <div class="row">
            <h1>Dice Probability Calculator</h1>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="form-group">
                    <label>Number of dice</label>
                    <input type="number" class="form-control" id="dice">
                </div>

                <div class="form-group">
                    <label>Number of sides</label>
                    <input type="number" class="form-control" id="side">
                </div>
                <br>
                <button class="btn btn-primary" id="calculate" onclick="cal_sim();">Calculate</button>
            </div>
            <div class="col-sm-8">
                <p>
                    Given the number of dice and the number of sides of the dice, the calculator simulates every possible
                    outcome and calculate the possibilties of getting each possible sum of dice with the assumption that
                    all the dice are fair. Results are displayed as percentages rounded to 6 decimal points.
                    
                    This uses a server-end function for simulation, so the input is throttled to 
                    prevent heavy load. The calculator will reject if the number of possible combination of dice exceeds
                    10000.
                </p>
            </div>
        </div>
        <div class="row">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Outcome</th>
                        <th scope="col">Probability</th>
                    </tr>
                </thead>
                <tbody id="result">
                </tbody>
            </table>
        </div>
    </div>
{% endblock app_content %}